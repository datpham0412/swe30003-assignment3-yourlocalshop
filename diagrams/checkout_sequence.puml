@startuml checkout_sequence
actor Customer
participant "ShoppingCartController" as SC
participant "OrderController" as OC
participant "PaymentController" as PC
participant "InvoiceController" as IC
participant "ShipmentController" as ShC

Customer -> SC: AddToCart(productId, quantity)
SC -> SC: validate credentials, find/create ShoppingCart
SC -> SC: AddItem(...) and RecalculateTotals()
SC --> Customer: CartResponse

Customer -> OC: CreateOrder(shipmentAddress, contact...)
OC -> OC: Validate cart, CreateOrderFromSnapshot()
OC -> OC: Persist Order, clear ShoppingCart
OC --> Customer: OrderResponse (OrderId, status)

Customer -> PC: ProcessPayment(orderId)
PC -> PC: Validate order status
PC -> PC: Create Payment; payment.ProcessPayment(...) deducts Inventory
PC -> IC: Create Invoice (Invoice.FromOrder)
PC -> ShC: Create Shipment (trackingNumber generated)
PC --> Customer: Payment confirmation + invoice + shipment info

note right of SC
  Implementation: `/Controllers/ShoppingCartController.cs`
end note

note right of OC
  Implementation: `/Controllers/OrderController.cs`
end note

@enduml
